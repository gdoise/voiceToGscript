<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test de la Synthèse Vocale (TTS)</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #status { font-weight: bold; color: green; }
    </style>
</head>
<body>
    <h1>Test de la Synthèse Vocale v1.1</h1>
    <p>Statut: <span id="status">Initialisation...</span></p>
    
    <button id="speakButton">Cliquez pour entendre "Bonjour le monde."</button>

    <script>
        // // _ Fonction de synthèse vocale simplifiée
        function dire(text) {
            // Vérifie si l'API est supportée
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'fr-FR';
                // // _ On tente la prononciation
                window.speechSynthesis.speak(utterance);
                document.getElementById('status').textContent = "Prononciation tentée en 'fr-FR'...";
            } else {
                document.getElementById('status').textContent = "ERREUR : L'API de synthèse vocale n'est pas supportée par ce navigateur.";
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const statusEl = document.getElementById('status');
            const speakButton = document.getElementById('speakButton');

            // // _ Fonction pour vérifier et afficher les voix disponibles
            function checkVoices() {
                const voices = window.speechSynthesis.getVoices();
                if (voices.length === 0) {
                    statusEl.textContent = "ATTENTION : Aucune voix n'est chargée. Vérifiez vos paramètres Chrome/Système.";
                    statusEl.style.color = 'orange';
                } else {
                    const frenchVoices = voices.filter(voice => voice.lang.startsWith('fr'));
                    
                    if (frenchVoices.length > 0) {
                        statusEl.textContent = `API de synthèse vocale prête. (${frenchVoices.length} voix(s) française(s) disponible(s)).`;
                        statusEl.style.color = 'green';
                    } else {
                        statusEl.textContent = `API de synthèse vocale prête, mais aucune voix française trouvée.`;
                        statusEl.style.color = 'darkorange';
                    }
                    console.log("Voix disponibles:", voices.map(v => v.name + ' (' + v.lang + ')')); // Aide au diagnostic
                }
            }
            
            // // _ Événement standard pour le chargement des voix
            if ('speechSynthesis' in window) {
                window.speechSynthesis.onvoiceschanged = checkVoices;

                // // _ Si les voix sont déjà chargées, on les vérifie immédiatement
                if (window.speechSynthesis.getVoices().length > 0) {
                    checkVoices();
                }

                // // _ Ajout d'un délai pour le cas où l'événement onvoiceschanged ne se déclenche pas bien au démarrage
                setTimeout(checkVoices, 1000); 
            } else {
                statusEl.textContent = "API de synthèse vocale non supportée.";
            }

            speakButton.addEventListener('click', () => {
                dire("Bonjour le monde. Si vous entendez cette phrase, le test TTS est un succès.");
            });
        });
    </script>
</body>
</html>
